<!DOCTYPE html>

<head>
  <link rel="stylesheet" href="./../notes_style.css">
  <style>
    body {
      font-family: 'Courier New', Courier, monospace;
      font-size: 17px;
      background-color: rgb(28, 28, 28);
      color: rgb(226, 234, 241);
    }

    .code {
      font-family: "Consolas";
      color: rgb(236, 255, 209);
      border: 1px;
      border-style: inset;
      width: 98%;
      margin: 0;
    }

    .con {
      background-color: black;
      border: 2px;
      border-style: double;
      padding: 3px;
      margin: 3px;
      width: 98%;
    }

    .comment {
      font-size: medium;
      font-style: italic;
      color: rgb(163, 161, 161);
    }

    h2 {
      color: rgb(72, 176, 245);
    }

    h3 {
      color: rgb(255, 163, 109);
    }

    h4 {
      color: rgb(71, 144, 177);
      font-style: italic;
    }

    li {
      color: rgb(249, 244, 170);
    }

    u {
      color: rgb(0, 221, 203);
    }

    .cmd {
      color: rgb(124, 255, 141);
      font-family: 'Courier New', Courier, monospace;
    }

    b {
      color: rgb(255, 226, 61);
    }

    .keyword {
      color: rgb(93, 190, 255);
    }

    .class {
      color: rgb(255, 61, 77);
    }
  </style>

</head>

<body>
  <div id="1" class="con">
    <h2>mongoosejs Ver: 8.1.2</h2>
    <p>Mongoose provides a straight-forward, schema-based solution to model your application data. It includes built-in
      type casting, validation, query building, business logic hooks and more, out of the box.</p>
    <br>
    <p>To handle initial connection errors, you should use .catch() or try/catch with async/await.</p>

    <b>Mongoose connection</b>
    <div class="code">
      <code class="!whitespace-pre hljs language-javascript">
      mongoose.<span class="hljs-title function_">connect</span>(<span class="hljs-string">'mongodb://127.0.0.1:27017/test'</span>)
        .<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">error</span> =&gt;</span> <span class="hljs-title function_">handleError</span>(error));
      
      <span class="hljs-comment">// Or:</span>
      <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">await</span> mongoose.<span class="hljs-title function_">connect</span>(<span class="hljs-string">'mongodb://127.0.0.1:27017/test'</span>);
      } <span class="hljs-keyword">catch</span> (error) {
        <span class="hljs-title function_">handleError</span>(error);
      }
      </code>
    </div>
    <br>
    <p>To handle errors after initial connection is established, you should listen for error events on the connection.
    </p>
    <div class="code">
      <code class="!whitespace-pre hljs language-javascript">
        mongoose.<span class="hljs-property">connection</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">'error'</span>, <span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> {
        <span class="hljs-title function_">logError</span>(err);
        });
      </code>
      <p>Note that Mongoose does not necessarily emit an 'error' event if it loses connectivity to MongoDB. You should
        listen to the disconnected event to report when Mongoose is disconnected from MongoDB.</p>
    </div>
    <br>
    <b>Connection events</b>
    <div class="code">
      <code class="!whitespace-pre hljs language-javascript">
        mongoose.<span class="hljs-property">connection</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">'connected'</span>, <span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'connected'</span>));
        mongoose.<span class="hljs-property">connection</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">'open'</span>, <span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'open'</span>));
        mongoose.<span class="hljs-property">connection</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">'disconnected'</span>, <span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'disconnected'</span>));
        mongoose.<span class="hljs-property">connection</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">'reconnected'</span>, <span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'reconnected'</span>));
        mongoose.<span class="hljs-property">connection</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">'disconnecting'</span>, <span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'disconnecting'</span>));
        mongoose.<span class="hljs-property">connection</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">'close'</span>, <span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'close'</span>));
        
        mongoose.<span class="hljs-title function_">connect</span>(<span class="hljs-string">'mongodb://127.0.0.1:27017/mongoose_test'</span>);
        </code>
    </div>
    <br>
    <p>With mongoose.createConnection(), use the following instead:</p>
    <div class="code">
      <code class="!whitespace-pre hljs language-javascript">
        <span class="hljs-keyword">const</span> conn = mongoose.<span class="hljs-title function_">createConnection</span>(<span class="hljs-string">'mongodb://127.0.0.1:27017/mongoose_test'</span>);

        conn.<span class="hljs-title function_">on</span>(<span class="hljs-string">'connected'</span>, <span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'connected'</span>));
        conn.<span class="hljs-title function_">on</span>(<span class="hljs-string">'open'</span>, <span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'open'</span>));
        conn.<span class="hljs-title function_">on</span>(<span class="hljs-string">'disconnected'</span>, <span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'disconnected'</span>));
        conn.<span class="hljs-title function_">on</span>(<span class="hljs-string">'reconnected'</span>, <span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'reconnected'</span>));
        conn.<span class="hljs-title function_">on</span>(<span class="hljs-string">'disconnecting'</span>, <span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'disconnecting'</span>));
        conn.<span class="hljs-title function_">on</span>(<span class="hljs-string">'close'</span>, <span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'close'</span>));
        </code>
    </div>
    <br>
    <b>TLS/SSL Connections - TLS/SSL Validation</b>
    <p>Mongoose supports connecting to MongoDB clusters that require TLS/SSL connections. Setting the tls option to true
      in mongoose.connect() or your connection string is enough to connect to a MongoDB cluster using TLS/SSL:</p>
    <div class="code">
      <code class="!whitespace-pre hljs language-javascript">
        mongoose.<span class="hljs-title function_">connect</span>(<span class="hljs-string">'mongodb://127.0.0.1:27017/test'</span>, {
        <span class="hljs-attr">tls</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">tlsAllowInvalidCertificates</span>: <span class="hljs-literal">true</span>,
        });
      </code>
    </div>
    <br>
    <b>Connection Pools</b>
    <p>The connection pool size is important because MongoDB currently can only process one operation per socket. So
      maxPoolSize functions as a cap on the number of concurrent operations.</p>
    <br>
    <p>Each connection, is backed by an internal configurable connection pool defaulting to a maximum size of 100.
      Adjust the pool size using your connection options:</p>
    <div class="code">
      <code class="!whitespace-pre hljs language-javascript">
        <span class="hljs-comment">// With object options</span>
        mongoose.<span class="hljs-title function_">createConnection</span>(uri, { <span class="hljs-attr">maxPoolSize</span>: <span class="hljs-number">10</span> });
          
        <span class="hljs-comment">// With connection string options</span>
        <span class="hljs-keyword">const</span> uri = <span class="hljs-string">'mongodb://127.0.0.1:27017/test?maxPoolSize=10'</span>;
        mongoose.<span class="hljs-title function_">createConnection</span>(uri);
      </code>
    </div>
  </div>

  <div id="2" class="con">
    <h2>Models</h2>
    <p>An instance of a model is called a document. Models are responsible for creating and reading documents from the
      MongoDB database.</p>
    <div class="code">
      <code class="!whitespace-pre hljs language-javascript">
      <span class="hljs-keyword">const</span> schema = <span class="hljs-keyword">new</span> mongoose.<span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">name</span>: <span class="hljs-title class_">String</span>, <span class="hljs-attr">size</span>: <span class="hljs-title class_">String</span> });
      <span class="hljs-keyword">const</span> <span class="hljs-title class_">Tank</span> = mongoose.<span class="hljs-title function_">model</span>(<span class="hljs-string">'Tank'</span>, schema);
          
      <span class="hljs-keyword">const</span> small = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Tank</span>({ <span class="hljs-attr">size</span>: <span class="hljs-string">'small'</span> });
      <span class="hljs-keyword">await</span> small.<span class="hljs-title function_">save</span>();
          
      <span class="hljs-comment">// or</span>
      <span class="hljs-keyword">await</span> <span class="hljs-title class_">Tank</span>.<span class="hljs-title function_">create</span>({ <span class="hljs-attr">size</span>: <span class="hljs-string">'small'</span> });
          
      <span class="hljs-comment">// or, for inserting large batches of documents</span>
      <span class="hljs-keyword">await</span> <span class="hljs-title class_">Tank</span>.<span class="hljs-title function_">insertMany</span>([{ <span class="hljs-attr">size</span>: <span class="hljs-string">'small'</span> }]);
    </code>
    </div>
    <p>Mongoose automatically looks for the plural, lowercased version of your model name. Thus, the model Tank is for
      the "tanks" collection in the database.
    </p>
  </div>

  <div id="3" class="con">
    <h2>CRUD</h2>
    <h3>Find, Update, Delete</h3>
    <p>Finding documents is easy with Mongoose, which supports the rich query syntax of MongoDB. Documents can be
      retrieved using a model's "find", "findById", "findOne", or "where" static functions.</p>
    <div class="code">
      <code class="!whitespace-pre hljs language-javascript">
      <span class="hljs-comment">// Find document</span>
      <span class="hljs-keyword">await</span> <span class="hljs-title class_">Tank</span>.<span class="hljs-title function_">find</span>({ <span class="hljs-attr">size</span>: <span class="hljs-string">'small'</span> }).<span class="hljs-title function_">where</span>(<span class="hljs-string">'createdDate'</span>).<span class="hljs-title function_">gt</span>(oneYearAgo).<span class="hljs-title function_">exec</span>();
          
      <span class="hljs-comment">// Delete document</span>
      <span class="hljs-keyword">await</span> <span class="hljs-title class_">Tank</span>.<span class="hljs-title function_">deleteOne</span>({ <span class="hljs-attr">size</span>: <span class="hljs-string">'large'</span> });
          
      <span class="hljs-comment">/* Models have static deleteOne() and deleteMany() functions for removing all documents matching the given filter. */</span>
          
      <span class="hljs-comment">// Update document</span>
      <span class="hljs-keyword">await</span> <span class="hljs-title class_">Tank</span>.<span class="hljs-title function_">updateOne</span>({ <span class="hljs-attr">size</span>: <span class="hljs-string">'large'</span> }, { <span class="hljs-attr">name</span>: <span class="hljs-string">'T-90'</span> });
    </code>
    </div>
    <i>If you want to update a single document in the db and return it to your application, use
      "<b>findOneAndUpdate</b>"
      instead.</i>

    <br><br>
    <h3>Change Streams</h3>
    <p>Change streams provide a way for you to listen to all inserts and updates going through your MongoDB database.
      Note that change streams works with MongoDB replica set.</p>
    <br>
    <p>
      If you try to call watch() when connected to a standalone MongoDB server, you'll get error: <i>MongoServerError:
        The $changeStream stage is only supported on replica sets</i>.
    </p>
    <div class="code">
      <code class="!whitespace-pre hljs language-javascript">
      <span class="hljs-keyword">const</span> <span class="hljs-title class_">Person</span> = mongoose.<span class="hljs-title function_">model</span>(<span class="hljs-string">'Person'</span>, <span class="hljs-keyword">new</span> mongoose.<span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">name</span>: <span class="hljs-title class_">String</span> }));

      <span class="hljs-comment">// Create a change stream. The 'change' event gets emitted when there's a</span>
      <span class="hljs-comment">// change in the database. Print what the change stream emits.</span>
      <span class="hljs-title class_">Person</span>.<span class="hljs-title function_">watch</span>().<span class="hljs-title function_">on</span>(<span class="hljs-string">'change'</span>, <span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(data));
        
      <span class="hljs-comment">// Insert a doc, will trigger the change stream handler above</span>
      <span class="hljs-keyword">await</span> <span class="hljs-title class_">Person</span>.<span class="hljs-title function_">create</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">'Axl Rose'</span> });
    </code>
    </div>
    <div class="code">
      <code class="!whitespace-pre hljs language-javascript">
      <span class="hljs-comment">// Output:</span>
      {
        <span class="hljs-attr">_id</span>: {
        <span class="hljs-attr">_data</span>: <span class="hljs-string">'8262408DAC000000012B022C0100296E5A10042890851837DB47'</span>
        },
        <span class="hljs-attr">operationType</span>: <span class="hljs-string">'insert'</span>,
        <span class="hljs-attr">clusterTime</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Timestamp</span>({ <span class="hljs-attr">t</span>: <span class="hljs-number">1648397740</span>, <span class="hljs-attr">i</span>: <span class="hljs-number">1</span> }),
        <span class="hljs-attr">fullDocument</span>: {
        <span class="hljs-attr">_id</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectId</span>(<span class="hljs-string">"62408dac6f5c42ff5ee087a2"</span>),
        <span class="hljs-attr">name</span>: <span class="hljs-string">'Axl Rose'</span>,
        <span class="hljs-attr">__v</span>: <span class="hljs-number">0</span>
        },
        <span class="hljs-attr">ns</span>: { <span class="hljs-attr">db</span>: <span class="hljs-string">'test'</span>, <span class="hljs-attr">coll</span>: <span class="hljs-string">'people'</span> },
        <span class="hljs-attr">documentKey</span>: { <span class="hljs-attr">_id</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectId</span>(<span class="hljs-string">"62408dac6f5c42ff5ee087a2"</span>) }
      }
      </code>
    </div>
  </div>

  <div id="4" class="con">
    <h2>Documents</h2>
    <p>Mongoose documents represent a one-to-one mapping to documents as stored in MongoDB. Each document is an instance
      of its Model.</p>

    <h3>Documents vs Models</h3>
    <p>Document and Model are distinct classes in Mongoose. The Model class is a subclass of the Document class. When
      you use the Model constructor, you create a new document.</p>













  </div>

  <div id="5" class="con">
    <h2>Indexes</h2>
    <p>Indexes are data structures that store a small portion of the collection's data to quickly locate documents
      within the colllection based on the indexed fields.</p>
    <p>MongoDB utilizes indexing to enhance query processing efficiency. <br>
      Without indexing, MongoDB would need to scan every document in the collection and retrieve only those matching the
      query. So Indexing limits how MongoDB scans the document.</p>
    <br>
    <p>Negative performance impact: For collection with a high write-to-read ratio, indexes are expensive because each
      insert must also update any indexes. </p>
    </p>

    <h3>Create an Index</h3>
    <div class="code">
      <code class="!whitespace-pre hljs language-javascript">
      db.<span class="hljs-property">collection</span>.<span class="hljs-title function_">createIndex</span>({ <span class="hljs-attr">name</span>: -<span class="hljs-number">1</span> })
      </code>
    </div>
    <h3>Index Types</h3>
    <ul>
      <li>Single Field Indexes - Single field indexes store information from a single field in a collection. </li>
      <li>Compound Indexes - Compound indexes are indexes that contain references to multiple fields.</li>
      <li>Multikey Indexes (Indexes on Array Fields)</li>
      <li>Clustered Indexes</li>
      <li>Text Indexes</li>
      <li>Unique Indexes</li>
      <li>Wildcard Indexes</li>
      <li>Geospatial Indexes</li>
      <li>Hashed Indexes</li>
    </ul>


    <p><b>Single Field Indexes</b> - Single field indexes store information from a single field in a collection. </p>
    <u>Create an Index on a Single Field</u>: <span class="comment">db.students.createIndex( { gpa: 1 } )</span>
    <br>
    <u>Create an Index on an Embedded Document</u>: Eg, Student location is stored in an embedded document called
    location.
    The location document contains the fields city and state. You can create an index on the location field to
    improve
    performance for queries on the location document: <span class="comment">db.students.createIndex( { location: 1 }
      )</span>
    <p>The following query uses the index on the location field:<br>
      <span class="comment">db.students.find( { location: { city: "Sacramento", state: "California" } } )</span>
    </p>

    <u>Create an Index on an Embedded Field</u>: You can create indexes on fields within embedded documents. <span
      class="comment">db.students.createIndex( { "location.state": 1 } )</span>
    <br>
    <p><b>Compound Indexes</b> - Compound indexes are indexes that contain references to multiple fields.</p>
    <u>Create a Compound Index</u>
    <br>
    <span class="comment">
      db.students.createIndex( {<br>
      name: 1,<br>
      gpa: -1<br>
      } )<br>
      <p>In this example:<br>
        - The index on name is ascending (1).<br>
        - The index on gpa is descending (-1).</p>
    </span>

    <p><b>Multikey Indexes (Indexes on Array Fields)</b>
    <p>Multikey indexes are indexes that improve the performance of queries on fields that contain array values.</p>
    <div class="code">
      <code class="!whitespace-pre hljs language-javascript">
    <span class="hljs-keyword">const</span> database = client.<span class="hljs-title function_">db</span>(<span class="hljs-string">"sample_mflix"</span>);
    <span class="hljs-keyword">const</span> movies = database.<span class="hljs-title function_">collection</span>(<span class="hljs-string">"movies"</span>);
        
    <span class="hljs-comment">// Create a multikey index on the "cast" field in the "movies" collection</span>
    <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> movies.<span class="hljs-title function_">createIndex</span>({ <span class="hljs-attr">cast</span>: <span class="hljs-number">1</span> });
        </code>
    </div>
    </p>
    <br>
    <p><b>Clustered Indexes:</b>
    <p>Clustered indexes are indexes that improve the performance of insert, update, and delete operations on clustered
      collections. Clustered collections store documents ordered by the clustered index key value.</p>
    </p>
    <p>To create a clustered index, specify the clusteredIndex option in the CollectionOption. The clusteredIndex option
      must specify the _id field as the key and the unique field as true.
      <br>
      The following example uses the createCollection() method to create a clustered index on the _id field in the
      vendors collection of the tea database.
    </p>
    <div class="code">
      <code class="!whitespace-pre hljs language-javascript">
    <span class="hljs-keyword">const</span> db = client.<span class="hljs-title function_">db</span>(<span class="hljs-string">'tea'</span>);
      <span class="hljs-keyword">await</span> db.<span class="hljs-title function_">createCollection</span>(<span class="hljs-string">'ratings'</span>, {
        <span class="hljs-attr">clusteredIndex</span>: {
          <span class="hljs-attr">key</span>: { <span class="hljs-attr">_id</span>: <span class="hljs-number">1</span> },
          <span class="hljs-attr">unique</span>: <span class="hljs-literal">true</span>
        }
    });
        </code>

    </div>

    <p><b>Text Indexes</b>
      Text indexes support text search queries on string content. These indexes can include any field whose value is a
      string or an array of string elements.
    </p>
    <div class="code">
      <code class="!whitespace-pre hljs language-javascript">
    <span class="hljs-comment">// Get the database and collection on which to create the index </span>
    <span class="hljs-keyword">const</span> myDB = client.<span class="hljs-title function_">db</span>(<span class="hljs-string">"testDB"</span>);
    <span class="hljs-keyword">const</span> myColl = myDB.<span class="hljs-title function_">collection</span>(<span class="hljs-string">"blogPosts"</span>);
        
    <span class="hljs-comment">// Create a text index on the "title" and "body" fields</span>
    <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> myColl.<span class="hljs-title function_">createIndex</span>(
      { <span class="hljs-attr">title</span>: <span class="hljs-string">"text"</span>, <span class="hljs-attr">body</span>: <span class="hljs-string">"text"</span> },
      { <span class="hljs-attr">default_language</span>: <span class="hljs-string">"english"</span> },
      { <span class="hljs-attr">weights</span>: { <span class="hljs-attr">body</span>: <span class="hljs-number">10</span>, <span class="hljs-attr">title</span>: <span class="hljs-number">3</span> } }
    );
        </code>

    </div>

    <p><b>Unique Indexes</b>
      Unique indexes ensure that the indexed fields do not store duplicate values. By default, MongoDB creates a unique
      index on the _id field during the creation of a collection. To create a unique index, specify the field or
      combination of fields that you want to prevent duplication on and set the unique option to true.
    </p>
    <div class="code">
      <code class="!whitespace-pre hljs language-javascript">
    <span class="hljs-keyword">const</span> database = client.<span class="hljs-title function_">db</span>(<span class="hljs-string">"sample_mflix"</span>);
    <span class="hljs-keyword">const</span> movies = database.<span class="hljs-title function_">collection</span>(<span class="hljs-string">"movies"</span>);
        
    <span class="hljs-comment">// Create a unique index on the "theaterId" field in the "theaters" collection.</span>
    <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> movies.<span class="hljs-title function_">createIndex</span>({ <span class="hljs-attr">theaterId</span>: <span class="hljs-number">1</span> }, { <span class="hljs-attr">unique</span>: <span class="hljs-literal">true</span> });
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Index created: <span class="hljs-subst">${result}</span>`</span>);
        </code>
    </div>
  </div>

  <div id="6" class="con">
    <h2>ReplicaSet</h2>
    A replica set is a group of MongoDB servers that maintain the same data set, providing high availability and fault
    tolerance. Replica sets are the recommended way to achieve redundancy and ensure data availability in MongoDB.
    <br>
    <b>What is replication in MongoDB?</b>
    <p>A replica set is a group of MongoDB instances that maintain the same data set. There are numbers of nodes in this
      replica set and among these nodes, one node is the primary node and the rest are secondary nodes.
      The primary node receives all read and write operations. Through oplog(operations log) the secondary members
      (nodes) then copy and apply these operations in an asynchronous process.</p>


  </div>

  <div id="7" class="con">
    <h2>Cluster</h2>
    <p>Cluster is some instances of MongoDB that are running in tandem with each other.<br>
      There are 2 types of Cluster in MongoDB.<br>
      <b>Replicate Sets</b>: They maintain the same data set across each of the instances. Therefore they provide high
      availability of data. They are also very useful in load balancing and they are the basis of all production
      deployments.<br>
      <b>Sharded Cluster</b>: In Sharded cluster, data is distributed between each of the instances. Data is not
      replicated along each of the clusters. Sharded clusters are useful when we have very large data sets.
      <br>
      <b>Setup MongoDB for Production deployment - Replica Sets cluster</b>
      <br>
    <ul>
      <li>To deploy replica sets what you need is to have a minimum of 2 instances of MongoDB running. So that one
        instance
        can act as a primary node and the second instance can act as a secondary node.</li>
      <li>All the read and write operations happen on the primary node and the replication is done on the secondary
        nodes.</li>
      <li>For load balancing, all the Write operations can happen on the primary node and the read preference can be set
        on
        the secondary node.</li>
    </ul>
    </p>
  </div>

  <div id="8" class="con">
    <h2>Aggregation</h2>
    <p>Aggregation is a way to filter, sort, group, reshape and analyze data without changing any data in your
      collection.
    </p>

    <p>
      <b>Aggregation</b>: Collection and summary of data
      <b>Stage</b>: One of the built-in methods that can be completed on the data, but does not permanently alter it
      <b>Aggregation pipeline</b>: A series of stages completed on the data in order
    </p>
    <br>

    <b>Fetch data from multiple docs</b>
    <div class="code">
      <code class="!whitespace-pre hljs language-javascript">
  <span class="hljs-comment">// customer collection - With, name, phone, email, address: ObjectId(9087353476567)</span>
  <span class="hljs-comment">// address collection - With, _id: ObjectId(9087353476567), street, pin, city, country</span>

  db.<span class="hljs-property">customer</span>.<span class="hljs-title function_">aggregate</span>([
    {
      <span class="hljs-attr">$lookup</span>: {
          <span class="hljs-attr">from</span>: <span class="hljs-string">"address"</span>,        <span class="hljs-comment">// collection name</span>
          <span class="hljs-attr">localField</span>: <span class="hljs-string">"address"</span>,  <span class="hljs-comment">// address field from customer collection with reference ObjectID</span>
          <span class="hljs-attr">foreignField</span>: <span class="hljs-string">"_id"</span>,    <span class="hljs-comment">// ID field from address collection</span>
          <span class="hljs-attr">as</span>: <span class="hljs-string">"Address"</span>           <span class="hljs-comment">// Alias name of new field</span>
      }
    }
  ])
    </code>

    </div>
    <br>

    <b>How many users are active?</b>
    <div class="code">
      <code class="!whitespace-pre hljs language-json">
      <span class="hljs-punctuation">[</span>
      <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"$match"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
          <span class="hljs-attr">"isActive"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span>
        <span class="hljs-punctuation">}</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"$count"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"isActive"</span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">]</span>
    </code>
    </div>
    <br>
    <b>Top 5 most common favorite fruits among users</b>
    <div class="code">
      <code class="!whitespace-pre hljs language-json">
    <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"$group"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"$favoriteFruit"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"count"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
          <span class="hljs-attr">"$sum"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span>
        <span class="hljs-punctuation">}</span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"$sort"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"count"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-1</span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"$limit"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">5</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
      </code>

    </div>
    <br>
    <b>What is the average number of tags per user?</b>
    <div class="code">
      <code class="!whitespace-pre hljs language-json"><span class="hljs-punctuation">[</span>
        <span class="hljs-punctuation">{</span>
          <span class="hljs-attr">"$unwind"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
            <span class="hljs-attr">"path"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"$tags"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"includeArrayIndex"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"string"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"preserveNullAndEmptyArrays"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span>
          <span class="hljs-punctuation">}</span>
        <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
        <span class="hljs-punctuation">{</span>
          <span class="hljs-attr">"$group"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
            <span class="hljs-attr">"_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"$_id"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"numberOfTags"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
              <span class="hljs-attr">"$sum"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span>
            <span class="hljs-punctuation">}</span>
          <span class="hljs-punctuation">}</span>
        <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
        <span class="hljs-punctuation">{</span>
          <span class="hljs-attr">"$group"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
            <span class="hljs-attr">"_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"averageNumOfTags"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
              <span class="hljs-attr">"$avg"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"$numberOfTags"</span>
            <span class="hljs-punctuation">}</span>
          <span class="hljs-punctuation">}</span>
        <span class="hljs-punctuation">}</span>
      <span class="hljs-punctuation">]</span>
      
      <span class="hljs-comment">// Using new add field and set length of the array (tags)</span>
      
      <span class="hljs-punctuation">[</span>
        <span class="hljs-punctuation">{</span>
          <span class="hljs-attr">"$addFields"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
            <span class="hljs-attr">"numOfTags"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
              <span class="hljs-attr">"$size"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> <span class="hljs-attr">"$ifNull"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"$tags"</span><span class="hljs-punctuation">,</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">]</span> <span class="hljs-punctuation">}</span>
            <span class="hljs-punctuation">}</span>
          <span class="hljs-punctuation">}</span>
        <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
        <span class="hljs-punctuation">{</span>
          <span class="hljs-attr">"$group"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
            <span class="hljs-attr">"_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"averageNoOfTags"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> <span class="hljs-attr">"$avg"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"$numOfTags"</span> <span class="hljs-punctuation">}</span>
          <span class="hljs-punctuation">}</span>
        <span class="hljs-punctuation">}</span>
      <span class="hljs-punctuation">]</span>
      </code>

    </div>
    <br>
    <b></b>
    <div class="code">

    </div>
    <br>
    <b></b>
    <div class="code">

    </div>


  </div>


  <div id="9" class="con">
    <h2>Pagination</h2>
    <p>Pagination in MongoDB typically involves using the skip() and limit() methods in conjunction with your query.
      Here's a basic example:</p>
    <div class="code">
      <code class="!whitespace-pre hljs language-javascript">
      <span class="hljs-keyword">const</span> pageNumber = <span class="hljs-number">req.query.pageNum || 0</span>; <span class="hljs-comment">// Page number (starting from 0)</span>
      <span class="hljs-keyword">const</span> itemsPerPage = <span class="hljs-number">5</span>; <span class="hljs-comment">// Number of items per page</span>
          
      <span class="hljs-keyword">const</span> skipAmount = (pageNumber * itemsPerPage);
          
      <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> db.<span class="hljs-title function_">collection</span>(<span class="hljs-string">'books'</span>)
          .<span class="hljs-title function_">find</span>(yourQuery)
          .<span class="hljs-title function_">skip</span>(skipAmount) <span class="hljs-comment">// If 0, it will not skip any - First page</span>
          .<span class="hljs-title function_">limit</span>(itemsPerPage)
          .<span class="hljs-title function_">toArray</span>();
      </code>
    </div>
    <div class="code">
      <code class="!whitespace-pre hljs language-javascript">db.<span class="hljs-property">movies</span>.<span class="hljs-title function_">aggregate</span>([
        {
          <span class="hljs-string">"$search"</span>: {
            <span class="hljs-string">"index"</span>: <span class="hljs-string">"pagination-tutorial"</span>,
            <span class="hljs-string">"text"</span>: {
              <span class="hljs-string">"query"</span>: <span class="hljs-string">"tom hanks"</span>,
              <span class="hljs-string">"path"</span>: <span class="hljs-string">"cast"</span>
            }
          }
        },
        {
          <span class="hljs-string">"$project"</span>: {
            <span class="hljs-string">"_id"</span>: <span class="hljs-number">0</span>,
            <span class="hljs-string">"title"</span>: <span class="hljs-number">1</span>,
            <span class="hljs-string">"cast"</span>: <span class="hljs-number">1</span>
          }
        },
        {
          <span class="hljs-string">"$skip"</span>: <span class="hljs-number">10</span>
        },
        {
          <span class="hljs-string">"$limit"</span>: <span class="hljs-number">10</span>
        }
      ])
      </code>
    </div>

  </div>

  <div id="10" class="con">
    <h2>Cursor</h2>
    A cursor is a pointer to list of documents, mongodb does not return us all the documnets at once when we use the
    find method on a collection, it returns us documnets in batches and that patch is called as cursor. <br>A cursor is
    nothing but an Object. While working with programming language like NodeJS and PHP, we cannot use this IT command,
    so in order to work with cursor, the language driver provides certain cursor methods which we can use in that
    particular language.<br><br>
    Eg:
    <ul>
      <li><b>toArray()</b> method, db.customer.find().toArray()</li>
      <li><b>forEach()</b> method:
        <div class="code">
          <code class="!whitespace-pre hljs language-javascript">
        db.<span class="hljs-property">customer</span>.<span class="hljs-title function_">find</span>().<span class="hljs-title function_">forEach</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">cust</span>) {
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"Customer Name: "</span> + cust.<span class="hljs-property">name</span>);
        });
        </code>
        </div>
      </li>
    </ul>


  </div>

  <div id="11" class="con">
    <h2>DataTypes</h2>
    <p>MongoDb supports datatypes like:
    <ul>
      <li><b>string</b></li>
      <li><b>boolean</b></li>
      <li><b>number: NumberInt(Int32), NumberLong(Int64).</b> By default every number will be store with 64bit floating
        point number</li>
      <li><b>Date</b>: ISODate, Timestamp</li>
      <li><b>Embedded Document</b></li>
      <li><b>Arrays</b></li>
    </ul>

    </p>

  </div>

  <div id="12" class="con">
    <h2>Relations in MongoDB</h2>
    <p>In MongoBD there two ways to specify the relations:
    <ul>
      <li><b>Embedded documents</b>: Here we dont have to query multiple collections, because everthing is avaliabel in
        same collection.<br>
        Disadvantage: This can lead to redundant or duplicate data in the collection.
      </li>
      <li><b>References</b>: Here we have less or no redundant data at all.<br>
        Disadvantage: We need to query multiple collections to get the desired results.</li>
    </ul>

    </p>


  </div>
  <div id="13" class="con">
    <h2>Populate</h2>
    <p>MongoDB has the join-like $lookup aggregation operator in versions >= 3.2.
      Mongoose has a more powerful alternative called populate(), which lets you reference documents in other
      collections.
      <br>
      Population is the process of automatically replacing the specified paths in the document with document(s) from
      other collection(s).
      We may populate a single document, multiple documents, a plain object, multiple plain objects, or all objects
      returned from a query.
    </p>
    <div class="code">
      <code class="!whitespace-pre hljs language-javascript">
      <span class="hljs-keyword">const</span> mongoose = <span class="hljs-built_in">require</span>(<span class="hljs-string">'mongoose'</span>);
      <span class="hljs-keyword">const</span> { <span class="hljs-title class_">Schema</span> } = mongoose;
          
      <span class="hljs-comment">// User Model</span>
      <span class="hljs-keyword">const</span> userSchema = <span class="hljs-title class_">Schema</span>({
        <span class="hljs-attr">_id</span>: <span class="hljs-title class_">Schema</span>.<span class="hljs-property">Types</span>.<span class="hljs-property">ObjectId</span>,
        <span class="hljs-attr">name</span>: <span class="hljs-title class_">String</span>,
        <span class="hljs-attr">age</span>: <span class="hljs-title class_">Number</span>,
        <span class="hljs-attr">posts</span>: [{ <span class="hljs-attr">type</span>: <span class="hljs-title class_">Schema</span>.<span class="hljs-property">Types</span>.<span class="hljs-property">ObjectId</span>, <span class="hljs-attr">ref</span>: <span class="hljs-string">'Post'</span> }]
       });
      <span class="hljs-keyword">const</span> <span class="hljs-title class_">User</span> = mongoose.<span class="hljs-title function_">model</span>(<span class="hljs-string">'User'</span>, userSchema);
          
      <span class="hljs-comment">// Post Model</span>
      <span class="hljs-keyword">const</span> postSchema = <span class="hljs-title class_">Schema</span>({
        <span class="hljs-attr">title</span>: <span class="hljs-title class_">String</span>,
         <span class="hljs-attr">content</span>: <span class="hljs-title class_">String</span>,
         <span class="hljs-attr">author</span>: { <span class="hljs-attr">type</span>: <span class="hljs-title class_">Schema</span>.<span class="hljs-property">Types</span>.<span class="hljs-property">ObjectId</span>, <span class="hljs-attr">ref</span>: <span class="hljs-string">'User'</span> },
         <span class="hljs-attr">comments</span>: [{ <span class="hljs-attr">type</span>: <span class="hljs-title class_">Schema</span>.<span class="hljs-property">Types</span>.<span class="hljs-property">ObjectId</span>, <span class="hljs-attr">ref</span>: <span class="hljs-string">'Comment'</span> }]
      });
      <span class="hljs-keyword">const</span> <span class="hljs-title class_">Post</span> = mongoose.<span class="hljs-title function_">model</span>(<span class="hljs-string">'Post'</span>, postSchema);
          
      <span class="hljs-comment">// Comment Model</span>
       <span class="hljs-keyword">const</span> commentSchema = <span class="hljs-title class_">Schema</span>({
         <span class="hljs-attr">text</span>: <span class="hljs-title class_">String</span>,
         <span class="hljs-attr">author</span>: { <span class="hljs-attr">type</span>: <span class="hljs-title class_">Schema</span>.<span class="hljs-property">Types</span>.<span class="hljs-property">ObjectId</span>, <span class="hljs-attr">ref</span>: <span class="hljs-string">'User'</span> },
       });
      <span class="hljs-keyword">const</span> <span class="hljs-title class_">Comment</span> = mongoose.<span class="hljs-title function_">model</span>(<span class="hljs-string">'Comment'</span>, commentSchema);
          </code>

    </div>

    <div class="code">
      <code class="!whitespace-pre hljs language-javascript">
    app.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/get-user-with-post'</span>, <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span>(<span class="hljs-params">req, res</span>){
    <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> <span class="hljs-title class_">User</span>.<span class="hljs-title function_">findOne</span>({<span class="hljs-attr">name</span>:<span class="hljs-string">'Tonu'</span>}).<span class="hljs-title function_">populate</span>({
        <span class="hljs-attr">path</span>: <span class="hljs-string">'posts'</span>,
        <span class="hljs-attr">populate</span>: {
            <span class="hljs-attr">path</span>: <span class="hljs-string">'comments'</span>,
            <span class="hljs-attr">model</span>: <span class="hljs-string">'Comment'</span>,
            <span class="hljs-attr">populate</span>: {
                <span class="hljs-attr">path</span>: <span class="hljs-string">'author'</span>,
                <span class="hljs-attr">model</span>: <span class="hljs-string">'User'</span>
            }
        }
    });
      res.<span class="hljs-title function_">send</span>(data);
    });
    </code>
    </div>



  </div>
  <div id="14" class="con">
    <h2></h2>
    <p>
      SQL (Structured Query Language) and NoSQL (Not Only SQL) are two different approaches to managing and manipulating
      data in databases, each with its own advantages and use cases.</p>

    <b>SQL</b>:<br>

    <u>Structure</u>: SQL databases are based on a structured schema, which means data is organized into tables with
    rows and
    columns. This structure enforces data integrity and ensures consistency.<br>

    <u>ACID Properties</u>: SQL databases typically adhere to ACID (Atomicity, Consistency, Isolation, Durability)
    properties, which ensure that database transactions are processed reliably.<br>

    <u>Relational Model</u>: SQL databases follow the relational model and support relationships between different
    tables,
    allowing complex queries and joins.<br>

    <u>Vertical Scalability</u>: SQL databases are usually vertically scalable, meaning you can increase the power of
    a
    single server by adding more CPU, RAM, or SSD.<br>

    Examples: MySQL, PostgreSQL, Oracle, SQL Server.<br>

    <b>NoSQL</b>:<br>

    <u>Schema Flexibility</u>: NoSQL databases offer flexibility in terms of schema design, allowing for dynamic and
    unstructured data storage. This makes them suitable for applications with evolving data models.<br>

    <u>Scalability</u>: NoSQL databases are designed for horizontal scalability, allowing them to handle large volumes
    of
    data by distributing it across multiple servers.<br>

    <u>Variety of Models</u>: NoSQL databases come in various models like key-value stores, document stores,
    column-family
    stores, and graph databases, each optimized for specific use cases.<br>

    <u>Performance</u>: NoSQL databases often provide high performance and low latency for read and write operations,
    especially when dealing with large-scale distributed systems.<br>

    Examples: MongoDB, Cassandra, Redis, Couchbase.<br>

    <b>When to Use SQL</b>:<br>

    When data structure is well-defined and unlikely to change frequently.<br>
    For applications that require complex queries and transactions.<br>
    When ACID compliance is necessary, such as in financial applications.<br>

    <b>When to Use NoSQL</b>:<br>

    For applications with rapidly changing data requirements.<br>
    When scalability and performance are crucial, especially for big data and real-time analytics.<br>
    When dealing with unstructured or semi-structured data like JSON documents.<br>

  </div>

  <div id="15" class="con">


    <p></p>
    <p></p>

  </div>
  <!--

  <div id="16" class="con">
    <h2></h2>

  </div>

  <div id="17" class="con">
    <h2></h2>

  </div>


  <div id="18" class="con">
    <h2></h2>


  </div>


  <div id="19" class="con">
    <h2></h2>


  </div>


  <div id="20" class="con">
    <h2></h2>


  </div>
  <div id="21" class="con">
    <h2></h2>

  </div>


  <div id="22" class="con">
    <h2></h2>
  </div> -->

  <div class="end"></div>


</body>

</html>